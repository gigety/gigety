{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/samuelsegal/git/gigety/gigety-reactjs/react-gigety/src/contexts/StompClientContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useGigUser } from 'redux/hooks/useGigUser';\nimport { GIGETY_MESSENGER_URL } from '../constants';\nimport { updateChatMessages, updateUserMessageNotifications } from '../redux/actions/messagesAction';\nconst StompClientContext = /*#__PURE__*/createContext(null);\nexport { StompClientContext };\n\nconst MessageContext = ({\n  children\n}) => {\n  _s();\n\n  let stompClient = null;\n  let wrappedStompClient = null;\n  const giguser = useGigUser();\n\n  const onConnected = () => {\n    console.log('SockJS iiiiiiissssss COnnected to STOMP protocol');\n    console.log('may be a good place to subscribe to user specific messages so they can be notified');\n\n    const onMessageRecieved = msg => {\n      const notification = JSON.parse(msg.body);\n      console.log('ALERT NOTIFICATION ::', notification);\n      dispatch(updateUserMessageNotifications(notification));\n    };\n\n    if (giguser) {\n      stompClient.subscribe(`/user/${giguser.id}/topic/messages`, onMessageRecieved);\n    }\n  };\n\n  const onError = error => {\n    console.error('GIGETY ERROR in STompCLientContext');\n    console.error(error);\n  }; //Connect stompClient to gigety-ws-service\n\n\n  const stomp = require('stompjs');\n\n  let SockJS = require('sockjs-client');\n\n  SockJS = new SockJS(GIGETY_MESSENGER_URL + '/ws'); //SockJS = new SockJS('http://localhost:7070/messenger/ws', null, {});\n\n  stompClient = stomp.over(SockJS);\n  stompClient.connect({}, onConnected, onError);\n\n  stomp.debug = f => f;\n\n  const dispatch = useDispatch();\n\n  const sendChatMessage = message => {\n    console.log(`sending Message ${message}`);\n    stompClient.send('/msg/chat', {}, JSON.stringify(message));\n    dispatch(updateChatMessages(message));\n  };\n\n  wrappedStompClient = {\n    stompClient,\n    sendChatMessage\n  };\n  console.log(`CONFIGURATION:::: wrappedStompClient = ${wrappedStompClient}`);\n  return /*#__PURE__*/_jsxDEV(StompClientContext.Provider, {\n    value: wrappedStompClient,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MessageContext, \"hmDje+g5IA0kLhQevsoqcp6L20I=\", false, function () {\n  return [useGigUser, useDispatch];\n});\n\n_c = MessageContext;\nexport default MessageContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"MessageContext\");","map":{"version":3,"sources":["/Users/samuelsegal/git/gigety/gigety-reactjs/react-gigety/src/contexts/StompClientContext.js"],"names":["React","createContext","useDispatch","useGigUser","GIGETY_MESSENGER_URL","updateChatMessages","updateUserMessageNotifications","StompClientContext","MessageContext","children","stompClient","wrappedStompClient","giguser","onConnected","console","log","onMessageRecieved","msg","notification","JSON","parse","body","dispatch","subscribe","id","onError","error","stomp","require","SockJS","over","connect","debug","f","sendChatMessage","message","send","stringify"],"mappings":";;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,QAAqC,OAArC;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAASC,UAAT,QAA2B,wBAA3B;AACA,SAASC,oBAAT,QAAqC,cAArC;AACA,SAASC,kBAAT,EAA6BC,8BAA7B,QAAmE,iCAAnE;AAEA,MAAMC,kBAAkB,gBAAGN,aAAa,CAAC,IAAD,CAAxC;AACA,SAASM,kBAAT;;AACA,MAAMC,cAAc,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAkB;AAAA;;AACxC,MAAIC,WAAW,GAAG,IAAlB;AACA,MAAIC,kBAAkB,GAAG,IAAzB;AACA,QAAMC,OAAO,GAAGT,UAAU,EAA1B;;AACA,QAAMU,WAAW,GAAG,MAAM;AACzBC,IAAAA,OAAO,CAACC,GAAR,CAAY,kDAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,oFAAZ;;AACA,UAAMC,iBAAiB,GAAIC,GAAD,IAAS;AAClC,YAAMC,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAArB;AACAP,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCG,YAArC;AACAI,MAAAA,QAAQ,CAAChB,8BAA8B,CAACY,YAAD,CAA/B,CAAR;AACA,KAJD;;AAKA,QAAIN,OAAJ,EAAa;AACZF,MAAAA,WAAW,CAACa,SAAZ,CAAuB,SAAQX,OAAO,CAACY,EAAG,iBAA1C,EAA4DR,iBAA5D;AACA;AACD,GAXD;;AAaA,QAAMS,OAAO,GAAIC,KAAD,IAAW;AAC1BZ,IAAAA,OAAO,CAACY,KAAR,CAAc,oCAAd;AACAZ,IAAAA,OAAO,CAACY,KAAR,CAAcA,KAAd;AACA,GAHD,CAjBwC,CAsBxC;;;AACA,QAAMC,KAAK,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,MAAIC,MAAM,GAAGD,OAAO,CAAC,eAAD,CAApB;;AACAC,EAAAA,MAAM,GAAG,IAAIA,MAAJ,CAAWzB,oBAAoB,GAAG,KAAlC,CAAT,CAzBwC,CA0BxC;;AACAM,EAAAA,WAAW,GAAGiB,KAAK,CAACG,IAAN,CAAWD,MAAX,CAAd;AACAnB,EAAAA,WAAW,CAACqB,OAAZ,CAAoB,EAApB,EAAwBlB,WAAxB,EAAqCY,OAArC;;AAEAE,EAAAA,KAAK,CAACK,KAAN,GAAeC,CAAD,IAAOA,CAArB;;AACA,QAAMX,QAAQ,GAAGpB,WAAW,EAA5B;;AAEA,QAAMgC,eAAe,GAAIC,OAAD,IAAa;AACpCrB,IAAAA,OAAO,CAACC,GAAR,CAAa,mBAAkBoB,OAAQ,EAAvC;AACAzB,IAAAA,WAAW,CAAC0B,IAAZ,CAAiB,WAAjB,EAA8B,EAA9B,EAAkCjB,IAAI,CAACkB,SAAL,CAAeF,OAAf,CAAlC;AACAb,IAAAA,QAAQ,CAACjB,kBAAkB,CAAC8B,OAAD,CAAnB,CAAR;AACA,GAJD;;AAKAxB,EAAAA,kBAAkB,GAAG;AACpBD,IAAAA,WADoB;AAEpBwB,IAAAA;AAFoB,GAArB;AAKApB,EAAAA,OAAO,CAACC,GAAR,CAAa,0CAAyCJ,kBAAmB,EAAzE;AACA,sBAAO,QAAC,kBAAD,CAAoB,QAApB;AAA6B,IAAA,KAAK,EAAEA,kBAApC;AAAA,cAAyDF;AAAzD;AAAA;AAAA;AAAA;AAAA,UAAP;AACA,CA7CD;;GAAMD,c;UAGWL,U,EA4BCD,W;;;KA/BZM,c;AA+CN,eAAeA,cAAf","sourcesContent":["import React, { createContext } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useGigUser } from 'redux/hooks/useGigUser';\nimport { GIGETY_MESSENGER_URL } from '../constants';\nimport { updateChatMessages, updateUserMessageNotifications } from '../redux/actions/messagesAction';\n\nconst StompClientContext = createContext(null);\nexport { StompClientContext };\nconst MessageContext = ({ children }) => {\n\tlet stompClient = null;\n\tlet wrappedStompClient = null;\n\tconst giguser = useGigUser();\n\tconst onConnected = () => {\n\t\tconsole.log('SockJS iiiiiiissssss COnnected to STOMP protocol');\n\t\tconsole.log('may be a good place to subscribe to user specific messages so they can be notified');\n\t\tconst onMessageRecieved = (msg) => {\n\t\t\tconst notification = JSON.parse(msg.body);\n\t\t\tconsole.log('ALERT NOTIFICATION ::', notification);\n\t\t\tdispatch(updateUserMessageNotifications(notification));\n\t\t};\n\t\tif (giguser) {\n\t\t\tstompClient.subscribe(`/user/${giguser.id}/topic/messages`, onMessageRecieved);\n\t\t}\n\t};\n\n\tconst onError = (error) => {\n\t\tconsole.error('GIGETY ERROR in STompCLientContext');\n\t\tconsole.error(error);\n\t};\n\n\t//Connect stompClient to gigety-ws-service\n\tconst stomp = require('stompjs');\n\tlet SockJS = require('sockjs-client');\n\tSockJS = new SockJS(GIGETY_MESSENGER_URL + '/ws');\n\t//SockJS = new SockJS('http://localhost:7070/messenger/ws', null, {});\n\tstompClient = stomp.over(SockJS);\n\tstompClient.connect({}, onConnected, onError);\n\n\tstomp.debug = (f) => f;\n\tconst dispatch = useDispatch();\n\n\tconst sendChatMessage = (message) => {\n\t\tconsole.log(`sending Message ${message}`);\n\t\tstompClient.send('/msg/chat', {}, JSON.stringify(message));\n\t\tdispatch(updateChatMessages(message));\n\t};\n\twrappedStompClient = {\n\t\tstompClient,\n\t\tsendChatMessage,\n\t};\n\n\tconsole.log(`CONFIGURATION:::: wrappedStompClient = ${wrappedStompClient}`);\n\treturn <StompClientContext.Provider value={wrappedStompClient}>{children}</StompClientContext.Provider>;\n};\n\nexport default MessageContext;\n"]},"metadata":{},"sourceType":"module"}